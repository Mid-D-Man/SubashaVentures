@page "/product/{slug}"
@using SubashaVentures.Components.Shared.Buttons
@using SubashaVentures.Components.Shared.Loading
@using SubashaVentures.Domain.Product

<PageTitle>@(Product?.Name ?? "Product") - Subasha Ventures</PageTitle>

<div class="product-detail-page">
    
    @if (IsLoading)
    {
        <div class="loading-container">
            <LoadingSpinner Size="LoadingSpinner.SpinnerSize.Large" 
                          Message="Loading product details..." />
        </div>
    }
    else if (Product == null)
    {
        <div class="error-container">
            <div class="error-icon">‚ùå</div>
            <h2 class="error-title">Product Not Found</h2>
            <p class="error-message">The product you're looking for doesn't exist.</p>
            <PrimaryButton OnClick="NavigateToShop" CssClass="btn-back-shop">
                Back to Shop
            </PrimaryButton>
        </div>
    }
    else
    {
        @* Header - Mobile Optimized *@
        <div class="product-header">
            <button class="btn-back" @onclick="NavigateBack">
                <span class="back-icon">‚Üê</span>
            </button>
            <h1 class="header-title">Product Details</h1>
            <button class="btn-share" @onclick="HandleShare">
                <span class="share-icon">‚§¥</span>
            </button>
        </div>

        @* Main Content *@
        <div class="product-content">
            <div class="product-layout">
                
                @* Image Gallery *@
                <div class="image-section">
                    <div class="main-image-container">
                        <img src="@GetCurrentImage()" 
                             alt="@Product.Name" 
                             class="main-image" />
                        
                        @* Badges *@
                        <div class="image-badges-left">
                            @if (Product.IsFeatured)
                            {
                                <span class="badge badge-featured">Featured</span>
                            }
                        </div>
                        
                        @if (Product.IsOnSale && Product.Discount > 0)
                        {
                            <span class="badge badge-sale">@Product.Discount% OFF</span>
                        }
                    </div>

                    @* Thumbnail Gallery *@
                    @if (Product.Images.Count > 1)
                    {
                        <div class="thumbnail-gallery">
                            @for (int i = 0; i < Product.Images.Count; i++)
                            {
                                int index = i;
                                <button class="thumbnail @(SelectedImageIndex == index ? "active" : "")"
                                        @onclick="@(() => SelectImage(index))">
                                    <img src="@Product.Images[index]" 
                                         alt="@Product.Name @(index + 1)" 
                                         class="thumbnail-image" />
                                </button>
                            }
                        </div>
                    }
                </div>

                @* Product Info *@
                <div class="info-section">
                    
                    @* Title and Category *@
                    <div class="product-meta">
                        <div class="meta-line">
                            <span class="category">@Product.Category</span>
                            @if (!string.IsNullOrEmpty(Product.Brand))
                            {
                                <span class="separator">‚Ä¢</span>
                                <span class="brand">@Product.Brand</span>
                            }
                        </div>
                        <h1 class="product-title">@Product.Name</h1>
                        <p class="product-description">@Product.Description</p>
                    </div>

                    @* Rating *@
                    @if (Product.Rating > 0)
                    {
                        <div class="product-rating">
                            <div class="rating-stars">
                                @for (int i = 0; i < 5; i++)
                                {
                                    int starIndex = i;
                                    <span class="star @(starIndex < Math.Floor(Product.Rating) ? "filled" : "")">‚òÖ</span>
                                }
                            </div>
                            <span class="rating-text">
                                @Product.DisplayRating (@Product.ReviewCount reviews)
                            </span>
                            <span class="separator">‚Ä¢</span>
                            <span class="sales-count">@Product.SalesCount sold</span>
                        </div>
                    }

                    @* Price *@
                    <div class="product-pricing">
                        <span class="current-price">‚Ç¶@Product.Price.ToString("N2")</span>
                        @if (Product.IsOnSale && Product.OriginalPrice.HasValue)
                        {
                            <span class="original-price">‚Ç¶@Product.OriginalPrice.Value.ToString("N2")</span>
                            <span class="badge badge-save">Save @Product.Discount%</span>
                        }
                    </div>

                    @* Stock Status *@
                    <div class="stock-status">
                        <span class="badge @(Product.Stock > 5 ? "badge-in-stock" : "badge-low-stock")">
                            @Product.StockStatus
                        </span>
                        <span class="stock-text">@Product.Stock units available</span>
                    </div>

                    @* Size Selection *@
                    @if (Product.Sizes.Any())
                    {
                        <div class="variant-section">
                            <label class="variant-label">
                                Size @(SelectedSize != null ? $"- {SelectedSize}" : "")
                            </label>
                            <div class="variant-options">
                                @foreach (var size in Product.Sizes)
                                {
                                    <button class="variant-btn @(SelectedSize == size ? "active" : "")"
                                            @onclick="@(() => SelectSize(size))">
                                        @size
                                    </button>
                                }
                            </div>
                        </div>
                    }

                    @* Color Selection *@
                    @if (Product.Colors.Any())
                    {
                        <div class="variant-section">
                            <label class="variant-label">
                                Color @(SelectedColor != null ? $"- {SelectedColor}" : "")
                            </label>
                            <div class="variant-options">
                                @foreach (var color in Product.Colors)
                                {
                                    <button class="variant-btn @(SelectedColor == color ? "active" : "")"
                                            @onclick="@(() => SelectColor(color))">
                                        @color
                                    </button>
                                }
                            </div>
                        </div>
                    }

                    @* Quantity *@
                    <div class="quantity-section">
                        <label class="variant-label">Quantity</label>
                        <div class="quantity-controls">
                            <button class="quantity-btn" 
                                    @onclick="DecreaseQuantity"
                                    disabled="@(Quantity <= 1)">
                                <span class="quantity-icon">‚àí</span>
                            </button>
                            <span class="quantity-value">@Quantity</span>
                            <button class="quantity-btn" 
                                    @onclick="IncreaseQuantity"
                                    disabled="@(Quantity >= Product.Stock)">
                                <span class="quantity-icon">+</span>
                            </button>
                        </div>
                    </div>

                    @* Trust Badges *@
                    <div class="trust-badges">
                        <div class="trust-item">
                            <span class="trust-icon">üöö</span>
                            <span class="trust-text">Free Shipping</span>
                        </div>
                        <div class="trust-item">
                            <span class="trust-icon">üõ°Ô∏è</span>
                            <span class="trust-text">Secure Payment</span>
                        </div>
                    </div>

                    @* Action Buttons - Sticky on mobile *@
                    <div class="action-buttons">
                        <SecondaryButton 
                            Variant="SecondaryButton.ButtonVariant.Outline"
                            Size="SecondaryButton.ButtonSize.Large"
                            OnClick="HandleAddToCart"
                            IsDisabled="!Product.IsInStock"
                            Icon="üõí"
                            CssClass="btn-add-cart">
                            Add to Cart
                        </SecondaryButton>
                        
                        <PrimaryButton 
                            Size="PrimaryButton.ButtonSize.Large"
                            OnClick="HandleBuyNow"
                            IsDisabled="!Product.IsInStock"
                            CssClass="btn-buy-now">
                            Buy Now
                        </PrimaryButton>
                        
                        <button class="btn-favorite @(IsFavorite ? "active" : "")"
                                @onclick="HandleToggleFavorite">
                            <span class="heart-icon">@(IsFavorite ? "‚ô•" : "‚ô°")</span>
                        </button>
                    </div>

                    @* Product Details *@
                    <div class="product-details">
                        <div class="details-section">
                            <h3 class="details-heading">Description</h3>
                            <p class="details-text">@Product.LongDescription</p>
                        </div>

                        <div class="details-grid">
                            <div class="detail-item">
                                <span class="detail-label">SKU</span>
                                <span class="detail-value">@Product.Sku</span>
                            </div>
                            <div class="detail-item">
                                <span class="detail-label">Category</span>
                                <span class="detail-value">@Product.Category</span>
                            </div>
                            @if (!string.IsNullOrEmpty(Product.SubCategory))
                            {
                                <div class="detail-item">
                                    <span class="detail-label">Type</span>
                                    <span class="detail-value">@Product.SubCategory</span>
                                </div>
                            }
                            <div class="detail-item">
                                <span class="detail-label">Brand</span>
                                <span class="detail-value">@Product.Brand</span>
                            </div>
                        </div>

                        @if (Product.Tags.Any())
                        {
                            <div class="details-section">
                                <h3 class="details-heading">Tags</h3>
                                <div class="tags-container">
                                    @foreach (var tag in Product.Tags)
                                    {
                                        <span class="tag">#@tag</span>
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </div>
            </div>
        </div>
    }
</div>
