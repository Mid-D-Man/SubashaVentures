@page "/user/settings"
@layout UserLayout
@using SubashaVentures.Components.Shared.Buttons
@using SubashaVentures.Components.Shared.Forms
@using SubashaVentures.Components.Shared.Modals
@using SubashaVentures.Components.Shared.Loading
@using SubashaVentures.Layout.User
<div class="settings-container">
    <div class="settings-header">
        <h1>Settings</h1>
        <p>Manage your account preferences and security</p>
    </div>

    @if (isLoading)
    {
        <LoadingSpinner />
    }
    else
    {
        <!-- Profile Section -->
        <div class="settings-section">
            <div class="section-header">
                <i class="fas fa-user-circle"></i>
                <h2>Profile</h2>
            </div>
            <div class="section-content">
                <div class="profile-display" @onclick="OpenProfileModal">
                    <div class="profile-avatar">
                        @if (!string.IsNullOrEmpty(profilePictureUrl))
                        {
                            <img src="@profilePictureUrl" alt="Profile" />
                        }
                        else
                        {
                            <i class="fas fa-user"></i>
                        }
                    </div>
                    <div class="profile-info">
                        <h3>@username</h3>
                        <p>@phoneNumber</p>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
        </div>

        <!-- Preferences Section -->
        <div class="settings-section">
            <div class="section-header">
                <i class="fas fa-sliders-h"></i>
                <h2>Preferences</h2>
            </div>
            <div class="section-content">
                <div class="settings-item" @onclick="OpenLanguageModal">
                    <div class="item-left">
                        <i class="fas fa-language"></i>
                        <span>Language</span>
                    </div>
                    <div class="item-right">
                        <span class="item-value">@selectedLanguage</span>
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                <div class="settings-item" @onclick="OpenCurrencyModal">
                    <div class="item-left">
                        <i class="fas fa-money-bill-wave"></i>
                        <span>Currency</span>
                    </div>
                    <div class="item-right">
                        <span class="item-value">@selectedCurrency</span>
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
                <div class="settings-item">
                    <div class="item-left">
                        <i class="fas fa-bell"></i>
                        <span>Notifications</span>
                    </div>
                    <div class="item-right">
                        <label class="toggle-switch">
                            <input type="checkbox" @bind="notificationsEnabled" />
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Security Section -->
        <div class="settings-section">
            <div class="section-header">
                <i class="fas fa-shield-alt"></i>
                <h2>Security & Payment</h2>
            </div>
            <div class="section-content">
                <div class="settings-item" @onclick='() => NavigateTo("/user/payment")'>
                    <div class="item-left">
                        <i class="fas fa-credit-card"></i>
                        <span>Payment Methods</span>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
                <div class="settings-item" @onclick="OpenSecurityModal">
                    <div class="item-left">
                        <i class="fas fa-lock"></i>
                        <span>Account Security</span>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
                <div class="settings-item" @onclick="OpenSafetyCenterModal">
                    <div class="item-left">
                        <i class="fas fa-exclamation-triangle"></i>
                        <span>Safety Center</span>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
        </div>

        <!-- App Information Section -->
        <div class="settings-section">
            <div class="section-header">
                <i class="fas fa-info-circle"></i>
                <h2>App Information</h2>
            </div>
            <div class="section-content">
                <div class="settings-item" @onclick="OpenAboutModal">
                    <div class="item-left">
                        <i class="fas fa-mobile-alt"></i>
                        <span>About SubashaVentures</span>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
                <div class="settings-item" @onclick="OpenPoliciesModal">
                    <div class="item-left">
                        <i class="fas fa-file-alt"></i>
                        <span>Policies</span>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
                <div class="settings-item" @onclick="OpenLegalModal">
                    <div class="item-left">
                        <i class="fas fa-gavel"></i>
                        <span>Legal Terms</span>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
        </div>

        <!-- Actions Section -->
        <div class="settings-section">
            <div class="section-header">
                <i class="fas fa-share-alt"></i>
                <h2>Share & Support</h2>
            </div>
            <div class="section-content">
                <div class="settings-item" @onclick="ShareApp">
                    <div class="item-left">
                        <i class="fas fa-share-nodes"></i>
                        <span>Share App</span>
                    </div>
                    <i class="fas fa-chevron-right"></i>
                </div>
            </div>
        </div>

        <!-- Logout Section -->
        <div class="settings-section logout-section">
            <div class="section-content">
                <div class="settings-item logout-item" @onclick="ShowLogoutConfirmation">
                    <div class="item-left">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="app-version">
            <p>Version @appVersion</p>
        </div>
    }

    <!-- Profile Edit Modal -->
    <DynamicModal IsOpen="showProfileModal" OnClose="CloseProfileModal" Title="Edit Profile">
        <BodyContent>
            <div class="modal-form">
                <div class="profile-picture-upload">
                    <div class="current-picture">
                        @if (!string.IsNullOrEmpty(tempProfilePictureUrl))
                        {
                            <img src="@tempProfilePictureUrl" alt="Profile" />
                        }
                        else
                        {
                            <i class="fas fa-user"></i>
                        }
                    </div>
                    <PrimaryButton OnClick="ChangePicture">Change Picture</PrimaryButton>
                </div>
                <InputField 
                    Label="Username" 
                    @bind-Value="tempUsername" 
                    Placeholder="Enter your username" />
                <InputField 
                    Label="Phone Number" 
                    @bind-Value="tempPhoneNumber" 
                    Placeholder="Enter your phone number" 
                    Type="tel" />
                <div class="modal-actions">
                    <SecondaryButton OnClick="CloseProfileModal">Cancel</SecondaryButton>
                    <PrimaryButton OnClick="SaveProfile">Save Changes</PrimaryButton>
                </div>
            </div>
        </BodyContent>
    </DynamicModal>

    <!-- Language Modal -->
    <DynamicModal IsOpen="showLanguageModal" OnClose="CloseLanguageModal" Title="Select Language">
        <BodyContent>
            <div class="modal-list">
                @foreach (var language in availableLanguages)
                {
                    <div class="list-item @(language == selectedLanguage ? "selected" : "")" 
                         @onclick="() => SelectLanguage(language)">
                        <span>@language</span>
                        @if (language == selectedLanguage)
                        {
                            <i class="fas fa-check"></i>
                        }
                    </div>
                }
            </div>
        </BodyContent>
    </DynamicModal>

    <!-- Currency Modal -->
    <DynamicModal IsOpen="showCurrencyModal" OnClose="CloseCurrencyModal" Title="Select Currency">
        <BodyContent>
            <div class="modal-list">
                @foreach (var currency in availableCurrencies)
                {
                    <div class="list-item @(currency.Code == selectedCurrency ? "selected" : "")" 
                         @onclick="() => SelectCurrency(currency.Code)">
                        <div class="currency-info">
                            <span class="currency-code">@currency.Code</span>
                            <span class="currency-name">@currency.Name</span>
                        </div>
                        @if (currency.Code == selectedCurrency)
                        {
                            <i class="fas fa-check"></i>
                        }
                    </div>
                }
            </div>
        </BodyContent>
    </DynamicModal>

    <!-- Security Modal -->
    <DynamicModal IsOpen="showSecurityModal" OnClose="CloseSecurityModal" Title="Account Security">
        <BodyContent>
            <div class="modal-content-text">
                <div class="security-options">
                    <div class="security-item" @onclick="ChangePassword">
                        <i class="fas fa-key"></i>
                        <div>
                            <h4>Change Password</h4>
                            <p>Update your account password</p>
                        </div>
                        <i class="fas fa-chevron-right"></i>
                    </div>
                    <div class="security-item">
                        <i class="fas fa-mobile-alt"></i>
                        <div>
                            <h4>Two-Factor Authentication</h4>
                            <p>@(twoFactorEnabled ? "Enabled" : "Not enabled")</p>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" @bind="twoFactorEnabled" />
                            <span class="toggle-slider"></span>
                        </label>
                    </div>
                    <div class="security-item" @onclick="ManageDevices">
                        <i class="fas fa-laptop"></i>
                        <div>
                            <h4>Manage Devices</h4>
                            <p>View devices logged into your account</p>
                        </div>
                        <i class="fas fa-chevron-right"></i>
                    </div>
                </div>
            </div>
        </BodyContent>
    </DynamicModal>

    <!-- Other modals remain the same... -->

    <!-- Logout Confirmation -->
    <ConfirmationPopup 
        IsOpen="showLogoutConfirmation"
        Title="Logout"
        Message="Are you sure you want to logout?"
        ConfirmText="Logout"
        CancelText="Cancel"
        OnConfirm="ConfirmLogout"
        OnCancel="CancelLogout" />
</div>

@code {
    // See Settings.razor.cs for code
}
