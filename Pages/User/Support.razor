@page "/user/support"
@layout UserLayout
@using SubashaVentures.Layout.User
@using SubashaVentures.Components.Shared.Cards
@using SubashaVentures.Components.Shared.Loading
@using SubashaVentures.Components.Shared.Forms

<div class="support-page">
    <div class="page-header">
        <div class="header-content">
            <div class="header-icon" @ref="headerIconRef"></div>
            <div class="header-text">
                <h1>Help & Support</h1>
                <p>Find answers to common questions or get in touch with our team</p>
            </div>
        </div>
    </div>

    @if (IsLoading)
    {
        <div class="support-loading">
            <LoadingSpinner Size="LoadingSpinner.SpinnerSize.Large" 
                          Message="Loading support options..." />
        </div>
    }
    else
    {
        <div class="support-tabs">
            <button class="tab-button @(ActiveTab == "faqs" ? "active" : "")" 
                    @onclick='() => SwitchTab("faqs")'>
                <div class="tab-icon" @ref="faqTabIconRef"></div>
                <span>FAQs</span>
            </button>
            <button class="tab-button @(ActiveTab == "contact" ? "active" : "")" 
                    @onclick='() => SwitchTab("contact")'>
                <div class="tab-icon" @ref="contactTabIconRef"></div>
                <span>Contact Us</span>
            </button>
        </div>

        @if (ActiveTab == "faqs")
        {
            <div class="faq-section">
                <div class="search-section">
                    <div class="search-container">
                        <div class="search-icon" @ref="searchIconRef"></div>
                        <input type="text" 
                               class="search-input" 
                               placeholder="Search for answers..."
                               @bind="SearchQuery"
                               @bind:event="oninput"
                               @onkeyup="HandleSearch" />
                        @if (!string.IsNullOrEmpty(SearchQuery))
                        {
                            <button class="clear-search" @onclick="ClearSearch">
                                <div class="clear-icon" @ref="clearIconRef"></div>
                            </button>
                        }
                    </div>
                    @if (!string.IsNullOrEmpty(SearchQuery) && FilteredFaqs.Any())
                    {
                        <p class="search-results-info">
                            Found @FilteredFaqs.Count result@(FilteredFaqs.Count != 1 ? "s" : "") for "@SearchQuery"
                        </p>
                    }
                    else if (!string.IsNullOrEmpty(SearchQuery) && !FilteredFaqs.Any())
                    {
                        <p class="search-results-info no-results">
                            No results found for "@SearchQuery". Try different keywords or browse categories below.
                        </p>
                    }
                </div>

                <div class="category-filters">
                    @foreach (var category in Enum.GetValues<SupportCategory>())
                    {
                        <button class="category-filter @(SelectedCategory == category ? "active" : "")"
                                @onclick="() => SelectCategory(category)">
                            <div class="category-icon" data-category="@category.ToString()"></div>
                            <span>@GetCategoryName(category)</span>
                            <span class="category-count">@GetCategoryCount(category)</span>
                        </button>
                    }
                </div>

                <div class="faq-list">
                    @if (FilteredFaqs.Any())
                    {
                        @foreach (var faq in FilteredFaqs)
                        {
                            <FaqItem Question="@faq.Question"
                                   Answer="@faq.Answer"
                                   Category="@faq.Category"
                                   IsExpanded="@(ExpandedFaqId == faq.Id)"
                                   IsHighlighted="@(faq.IsHighlighted)"
                                   RelatedLinks="@faq.RelatedLinks"
                                   OnToggle="@((expanded) => HandleFaqToggle(faq.Id, expanded))" />
                        }
                    }
                    else
                    {
                        <div class="no-faqs">
                            <div class="no-faqs-icon" @ref="noResultsIconRef"></div>
                            <h3>No FAQs found</h3>
                            <p>Try adjusting your search or browse different categories</p>
                        </div>
                    }
                </div>
            </div>
        }
        else
        {
            <div class="contact-section">
                <div class="contact-intro">
                    <h2>Get in Touch</h2>
                    <p>Need personalized assistance? Our support team is here to help you.</p>
                </div>

                <div class="contact-methods">
                    <div class="contact-card whatsapp" @onclick="OpenWhatsApp">
                        <div class="contact-card-icon" @ref="whatsappIconRef"></div>
                        <div class="contact-card-content">
                            <h3>WhatsApp Support</h3>
                            <p class="contact-detail">+234 900 765 4321</p>
                            <p class="contact-description">Chat with us instantly for quick assistance</p>
                            <span class="availability">Available 24/7</span>
                        </div>
                        <div class="contact-arrow" @ref="whatsappArrowRef"></div>
                    </div>

                    <div class="contact-card email" @onclick="OpenEmail">
                        <div class="contact-card-icon" @ref="emailIconRef"></div>
                        <div class="contact-card-content">
                            <h3>Email Support</h3>
                            <p class="contact-detail">support@subashaventures.com</p>
                            <p class="contact-description">Send us a detailed message and we'll respond soon</p>
                            <span class="availability">Response within 24 hours</span>
                        </div>
                        <div class="contact-arrow" @ref="emailArrowRef"></div>
                    </div>
                </div>

                <div class="safety-notice">
                    <div class="safety-icon" @ref="safetyIconRef"></div>
                    <div class="safety-content">
                        <h3>Stay Safe While Shopping</h3>
                        <ul class="safety-tips">
                            <li>Never share your password or OTP with anyone, including our staff</li>
                            <li>Be cautious of deals that seem too good to be true</li>
                            <li>Only communicate through our official channels listed above</li>
                            <li>Report suspicious activity immediately to our support team</li>
                            <li>Verify seller ratings and reviews before making purchases</li>
                        </ul>
                    </div>
                </div>
            </div>
        }
    }
</div>
