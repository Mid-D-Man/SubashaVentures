@page "/user/support"
@layout UserLayout
@using SubashaVentures.Components.Shared.Buttons
@using SubashaVentures.Components.Shared.Forms
@using SubashaVentures.Components.Shared.Modals
@using SubashaVentures.Components.Shared.Loading
@using Microsoft.AspNetCore.Components.Forms

<div class="support-page">
    <div class="page-header">
        <div>
            <h1>Help & Support</h1>
            <p>We're here to help you</p>
        </div>
        <PrimaryButton OnClick="OpenContactModal" 
                      Size="PrimaryButton.ButtonSize.Medium">
            Contact Support
        </PrimaryButton>
    </div>

    @if (IsLoading)
    {
        <div class="support-loading">
            <LoadingSpinner Size="LoadingSpinner.SpinnerSize.Large" 
                          Message="Loading support options..." />
        </div>
    }
    else
    {
        <!-- Quick Actions -->
        <div class="section">
            <h2 class="section-title">Quick Actions</h2>
            <div class="quick-actions">
                <div class="action-card" @onclick="() => SelectCategory(SupportCategory.Orders)">
                    <div class="action-icon">üì¶</div>
                    <h3>Track Order</h3>
                    <p>Check your order status</p>
                </div>
                <div class="action-card" @onclick="() => SelectCategory(SupportCategory.Returns)">
                    <div class="action-icon">‚Ü©Ô∏è</div>
                    <h3>Returns</h3>
                    <p>Start a return request</p>
                </div>
                <div class="action-card" @onclick="() => SelectCategory(SupportCategory.Delivery)">
                    <div class="action-icon">üöö</div>
                    <h3>Delivery Info</h3>
                    <p>Shipping & delivery</p>
                </div>
                <div class="action-card" @onclick="OpenContactModal">
                    <div class="action-icon">üí¨</div>
                    <h3>Live Chat</h3>
                    <p>Chat with support</p>
                </div>
            </div>
        </div>

        <!-- FAQ Section -->
        <div class="section">
            <h2 class="section-title">Frequently Asked Questions</h2>
            <div class="faq-categories">
                @foreach (var category in Enum.GetValues<SupportCategory>())
                {
                    <button class="category-tab @(SelectedCategory == category ? "active" : "")"
                            @onclick="() => SelectCategory(category)">
                        @GetCategoryName(category)
                    </button>
                }
            </div>
            <div class="faq-list">
                @foreach (var faq in FilteredFaqs)
                {
                    <div class="faq-item @(ExpandedFaqId == faq.Id ? "expanded" : "")"
                         @onclick="() => ToggleFaq(faq.Id)">
                        <div class="faq-question">
                            <h3>@faq.Question</h3>
                            <span class="faq-toggle">@(ExpandedFaqId == faq.Id ? "‚àí" : "+")</span>
                        </div>
                        @if (ExpandedFaqId == faq.Id)
                        {
                            <div class="faq-answer">
                                <p>@faq.Answer</p>
                            </div>
                        }
                    </div>
                }
            </div>
        </div>

        <!-- Contact Methods -->
        <div class="section">
            <h2 class="section-title">Get In Touch</h2>
            <div class="contact-methods">
                <div class="contact-card">
                    <div class="contact-icon">üìß</div>
                    <h3>Email Support</h3>
                    <p>support@subashaventures.com</p>
                    <span class="response-time">Response in 24 hours</span>
                </div>
                <div class="contact-card">
                    <div class="contact-icon">üìû</div>
                    <h3>Phone Support</h3>
                    <p>+234 (0) 800 123 4567</p>
                    <span class="response-time">Mon-Fri, 9AM-6PM WAT</span>
                </div>
                <div class="contact-card">
                    <div class="contact-icon">üí¨</div>
                    <h3>WhatsApp</h3>
                    <p>+234 (0) 900 765 4321</p>
                    <span class="response-time">Available 24/7</span>
                </div>
            </div>
        </div>

        <!-- Your Tickets -->
        @if (SupportTickets.Any())
        {
            <div class="section">
                <h2 class="section-title">Your Support Tickets</h2>
                <div class="tickets-list">
                    @foreach (var ticket in SupportTickets)
                    {
                        <div class="ticket-card" @onclick="() => ViewTicket(ticket.Id)">
                            <div class="ticket-header">
                                <div>
                                    <h3>@ticket.Subject</h3>
                                    <span class="ticket-id">Ticket #@ticket.Id</span>
                                </div>
                                <span class="ticket-status @ticket.Status.ToString().ToLower()">
                                    @ticket.Status
                                </span>
                            </div>
                            <p class="ticket-message">@ticket.LastMessage</p>
                            <div class="ticket-footer">
                                <span class="ticket-date">@ticket.CreatedDate.ToString("MMM dd, yyyy")</span>
                                <span class="ticket-category">@GetCategoryName(ticket.Category)</span>
                            </div>
                        </div>
                    }
                </div>
            </div>
        }

        <!-- Safety & Trust -->
        <div class="section">
            <h2 class="section-title">Safety & Trust</h2>
            <div class="safety-card">
                <div class="safety-icon">üõ°Ô∏è</div>
                <div class="safety-content">
                    <h3>Stay Safe While Shopping</h3>
                    <ul class="safety-tips">
                        <li>Never share your password or OTP with anyone</li>
                        <li>Be cautious of too-good-to-be-true deals</li>
                        <li>Only communicate through our official channels</li>
                        <li>Report suspicious activity immediately</li>
                        <li>Verify seller ratings and reviews before purchase</li>
                    </ul>
                    <PrimaryButton OnClick="ReportScam" 
                                  Size="PrimaryButton.ButtonSize.Small"
                                  Variant="PrimaryButton.ButtonVariant.Outline">
                        Report Suspicious Activity
                    </PrimaryButton>
                </div>
            </div>
        </div>
    }
</div>

<!-- Contact Support Modal -->
<DynamicModal IsOpen="ShowContactModal" 
             Title="Contact Support" 
             OnClose="CloseContactModal"
             OnConfirm="SubmitContactForm"
             IsProcessing="IsSubmitting">
    <BodyContent>
        <div class="contact-form">
            <InputField Label="Subject" 
                       @bind-Value="ContactSubject" 
                       Placeholder="Brief description of your issue"
                       IsRequired="true" />
            
            <div class="form-group">
                <label>Category</label>
                <select class="form-select" @bind="ContactCategory">
                    @foreach (var category in Enum.GetValues<SupportCategory>())
                    {
                        <option value="@category">@GetCategoryName(category)</option>
                    }
                </select>
            </div>

            <div class="form-group">
                <label>Message</label>
                <textarea class="form-textarea" 
                         @bind="ContactMessage" 
                         placeholder="Describe your issue in detail..."
                         rows="6"></textarea>
            </div>

            <div class="form-group">
                <label>Attach File (Optional)</label>
                <InputFile OnChange="HandleFileUpload" class="file-input" />
                <span class="file-hint">Max size: 5MB. Formats: jpg, png, pdf</span>
            </div>
        </div>
    </BodyContent>
</DynamicModal>

@code {
    // See Support.razor.cs for code
}
