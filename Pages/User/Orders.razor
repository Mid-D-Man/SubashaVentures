@page "/user/orders"
@using SubashaVentures.Components.Shared.Loading
@using SubashaVentures.Components.Shared.Cards
@using SubashaVentures.Domain.Order

<div class="orders-page">
    @if (IsLoading)
    {
        <div class="orders-loading">
            <LoadingSpinner Size="LoadingSpinner.SpinnerSize.Large"
                          Variant="LoadingSpinner.SpinnerVariant.Circle"
                          Message="Loading your orders..." />
        </div>
    }
    else if (!FilteredOrders.Any())
    {
        <div class="empty-state">
            <div class="empty-icon">üì¶</div>
            <h2>No Orders Yet</h2>
            <p>You haven't placed any orders yet. Start shopping to see your order history here.</p>
            <button class="btn-start-shopping" @onclick="NavigateToShop">
                Start Shopping
            </button>
        </div>
    }
    else
    {
        <!-- Page Header -->
        <div class="page-header">
            <div class="header-content">
                <h1>My Orders</h1>
                <p>Track and manage all your orders</p>
            </div>
            
            <div class="header-stats">
                <div class="stat-item">
                    <div class="stat-value">@OrdersList.Count</div>
                    <div class="stat-label">Total Orders</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value">‚Ç¶@TotalSpent.ToString("N0")</div>
                    <div class="stat-label">Total Spent</div>
                </div>
            </div>
        </div>

        <!-- Filters -->
        <div class="orders-filters">
            <button class="filter-btn @(FilterStatus == "All" ? "active" : "")" 
                    @onclick='() => FilterOrders("All")'>
                All Orders
                <span class="filter-count">(@OrdersList.Count)</span>
            </button>
            <button class="filter-btn @(FilterStatus == "Pending" ? "active" : "")" 
                    @onclick='() => FilterOrders("Pending")'>
                Pending
                <span class="filter-count">(@GetStatusCount(OrderStatus.Pending))</span>
            </button>
            <button class="filter-btn @(FilterStatus == "Processing" ? "active" : "")" 
                    @onclick='() => FilterOrders("Processing")'>
                Processing
                <span class="filter-count">(@GetStatusCount(OrderStatus.Processing))</span>
            </button>
            <button class="filter-btn @(FilterStatus == "Shipped" ? "active" : "")" 
                    @onclick='() => FilterOrders("Shipped")'>
                Shipped
                <span class="filter-count">(@GetStatusCount(OrderStatus.Shipped))</span>
            </button>
            <button class="filter-btn @(FilterStatus == "Delivered" ? "active" : "")" 
                    @onclick='() => FilterOrders("Delivered")'>
                Delivered
                <span class="filter-count">(@GetStatusCount(OrderStatus.Delivered))</span>
            </button>
        </div>

        <!-- Orders List -->
        <div class="orders-list">
            @foreach (var order in FilteredOrders)
            {
                <div class="order-card">
                    <!-- Order Header -->
                    <div class="order-header">
                        <div class="order-info">
                            <h3 class="order-number">Order #@order.OrderNumber</h3>
                            <div class="order-meta">
                                <div class="order-date">
                                    <span class="icon">üìÖ</span>
                                    <span>@order.CreatedAt.ToString("MMM dd, yyyy")</span>
                                </div>
                                <div class="order-time">
                                    <span class="icon">üïê</span>
                                    <span>@order.CreatedAt.ToString("hh:mm tt")</span>
                                </div>
                            </div>
                        </div>
                        <div class="order-status @GetStatusClass(order.Status)">
                            <span>@GetStatusIcon(order.Status)</span>
                            <span>@order.Status</span>
                        </div>
                    </div>

                    <!-- Order Items (Show first 3) -->
                    <div class="order-items">
                        @foreach (var item in order.Items.Take(3))
                        {
                            <OrderItemCard OrderItem="item" CssClass="order-item-compact" />
                        }
                        @if (order.Items.Count > 3)
                        {
                            <div class="more-items-notice">
                                + @(order.Items.Count - 3) more item@(order.Items.Count - 3 > 1 ? "s" : "")
                            </div>
                        }
                    </div>

                    <!-- Order Summary -->
                    <div class="order-summary">
                        <div class="summary-row">
                            <span class="summary-label">Subtotal</span>
                            <span class="summary-value">‚Ç¶@order.Subtotal.ToString("N0")</span>
                        </div>
                        <div class="summary-row">
                            <span class="summary-label">Shipping</span>
                            <span class="summary-value">‚Ç¶@order.ShippingCost.ToString("N0")</span>
                        </div>
                        @if (order.Discount > 0)
                        {
                            <div class="summary-row discount">
                                <span class="summary-label">Discount</span>
                                <span class="summary-value">-‚Ç¶@order.Discount.ToString("N0")</span>
                            </div>
                        }
                        <div class="summary-row total">
                            <span class="summary-label">Total</span>
                            <span class="summary-value">‚Ç¶@order.Total.ToString("N0")</span>
                        </div>
                    </div>

                    <!-- Shipping Info -->
                    <div class="shipping-info">
                        <div class="shipping-header">
                            <span class="icon">üöö</span>
                            <span class="shipping-label">Shipping Information</span>
                        </div>
                        <p class="shipping-address">@order.ShippingAddress</p>
                        <p class="shipping-method">
                            <strong>Method:</strong> @order.ShippingMethod
                        </p>
                    </div>

                    <!-- Order Footer -->
                    <div class="order-footer">
                        <div class="order-payment">
                            <div class="payment-method">
                                <span>@GetPaymentIcon(order.PaymentMethod)</span>
                                <span>@order.PaymentMethod</span>
                            </div>
                            <div class="payment-status @GetPaymentStatusClass(order.PaymentStatus)">
                                @order.PaymentStatus
                            </div>
                        </div>

                        <div class="order-actions">
                            @if (order.Status == OrderStatus.Shipped || order.Status == OrderStatus.Processing)
                            {
                                <button class="btn-track" @onclick='() => TrackOrder(order.Id)'>
                                    <span class="icon">üìç</span>
                                    Track Order
                                </button>
                            }
                            
                            <button class="btn-view" @onclick='() => ViewOrder(order.Id)'>
                                <span class="icon">üëÅÔ∏è</span>
                                View Details
                            </button>

                            @if (order.Status == OrderStatus.Pending || order.Status == OrderStatus.Processing)
                            {
                                <button class="btn-cancel" @onclick='() => CancelOrder(order.Id)'>
                                    <span class="icon">‚ùå</span>
                                    Cancel
                                </button>
                            }
                        </div>
                    </div>
                </div>
            }
        </div>

        <!-- Load More -->
        @if (HasMoreOrders)
        {
            <div class="load-more-container">
                <button class="btn-load-more" 
                        @onclick="LoadMoreOrders" 
                        disabled="@IsLoadingMore">
                    @if (IsLoadingMore)
                    {
                        <div class="spinner-small"></div>
                        <span>Loading...</span>
                    }
                    else
                    {
                        <span>Load More Orders</span>
                    }
                </button>
            </div>
        }
    }
</div>
