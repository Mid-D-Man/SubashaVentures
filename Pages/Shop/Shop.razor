@page "/shop"
@using SubashaVentures.Components.Shared.Cards
@using SubashaVentures.Components.Shared.Loading
@using SubashaVentures.Components.Shared.Buttons
@using SubashaVentures.Layout.Shop
@layout ShopLayout

<div class="shop-page">
    
    @* Top Controls *@
    <div class="shop-controls">
        
        @* Mobile Filter Button *@
        <button class="btn-mobile-filters mobile-only" @onclick="OpenMobileFilters">
            <span class="filter-icon">üîç</span>
            <span>Filters</span>
            @if (HasActiveFilters)
            {
                <span class="filter-badge">@ActiveFilterCount</span>
            }
        </button>
        
        @* Sort Dropdown *@
        <div class="sort-wrapper">
            <select class="sort-select" @bind="SelectedSort" @bind:after="HandleSortChanged">
                <option value="default">Sort By</option>
                <option value="price-asc">Price: Low to High</option>
                <option value="price-desc">Price: High to Low</option>
                <option value="rating-desc">Rating: High to Low</option>
                <option value="name-asc">Name: A-Z</option>
                <option value="newest">Newest First</option>
            </select>
        </div>
    </div>

    @* Results Info *@
    @if (!IsLoading && FilteredProducts.Any())
    {
        <div class="results-info">
            <p>Showing @GetResultsRange() of @FilteredProducts.Count products</p>
            @if (HasActiveFilters)
            {
                <button class="clear-filters-btn" @onclick="ResetFilters">
                    Clear Filters
                </button>
            }
        </div>
    }

    @* Products Grid *@
    <div class="shop-products-section">
        @if (IsLoading)
        {
            <div class="product-grid">
                @for (int i = 0; i < 12; i++)
                {
                    <SkeletonCard />
                }
            </div>
        }
        else if (HasError)
        {
            <div class="error-state">
                <div class="error-icon">‚ö†Ô∏è</div>
                <h3>Failed to Load Products</h3>
                <p>@ErrorMessage</p>
                <PrimaryButton OnClick="LoadProducts">Try Again</PrimaryButton>
            </div>
        }
        else if (!FilteredProducts.Any())
        {
            <div class="empty-state">
                <div class="empty-icon">üîç</div>
                <h3>No Products Found</h3>
                <p>Try adjusting your filters or search query.</p>
                <SecondaryButton Variant="SecondaryButton.ButtonVariant.Outline" OnClick="ResetFilters">
                    Reset Filters
                </SecondaryButton>
            </div>
        }
        else
        {
            <div class="product-grid">
                @foreach (var product in CurrentPageProducts)
                {
                    <ShopProductCard 
                        Product="@product"
                        OnAddToCart="HandleAddToCart"
                        OnToggleFavorite="HandleToggleFavorite" />
                }
            </div>

            @if (TotalPages > 1)
            {
                <div class="pagination">
                    <button class="page-btn" @onclick="PreviousPage" disabled="@(CurrentPage == 1)">
                        ‚Üê
                    </button>
                    <div class="page-numbers">
                        @foreach (var pageNum in GetVisiblePages())
                        {
                            <button class="page-btn @(pageNum == CurrentPage ? "active" : "")"
                                    @onclick="@(() => GoToPage(pageNum))">
                                @pageNum
                            </button>
                        }
                    </div>
                    <button class="page-btn" @onclick="NextPage" disabled="@(CurrentPage == TotalPages)">
                        ‚Üí
                    </button>
                </div>
            }
        }
    </div>

    @* Footer *@
    <ShopFooter />
</div>

@* Mobile Filter Overlay *@
@if (ShowMobileFilters)
{
    <div class="mobile-filter-overlay" @onclick="CloseMobileFilters">
        <div class="mobile-filter-drawer" @onclick:stopPropagation="true">
            <div class="mobile-filter-header">
                <h2 class="filter-title">Filters</h2>
                <button class="filter-close-btn" @onclick="CloseMobileFilters">
                    <span class="close-icon">‚úï</span>
                </button>
            </div>
            <ShopFilterPanel OnFiltersChanged="HandleFiltersChanged" CurrentFilters="@CurrentFilters" />
        </div>
    </div>
}
