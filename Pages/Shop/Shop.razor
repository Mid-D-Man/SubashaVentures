@page "/shop"
@using SubashaVentures.Components.Shared.Cards
@using SubashaVentures.Components.Shared.Loading
@using SubashaVentures.Components.Shared.Buttons
@using SubashaVentures.Domain.Product
@using SubashaVentures.Layout.Shop
@layout ShopLayout
@inject NavigationManager NavigationManager

<PageTitle>Shop - Subasha Ventures</PageTitle>

<div class="shop-page">
    
    @* Controls Bar *@
    <div class="shop-controls">
        <SecondaryButton 
            Variant="SecondaryButton.ButtonVariant.Outline"
            Size="SecondaryButton.ButtonSize.Medium"
            OnClick="OpenFilters"
            Icon="üîç"
            CssClass="btn-filters">
            Filters
        </SecondaryButton>
        
        <div class="sort-wrapper">
            <select class="sort-select" @bind="SelectedSort" @bind:after="ApplySorting">
                <option value="default">Sort By</option>
                <option value="price-asc">Price: Low to High</option>
                <option value="price-desc">Price: High to Low</option>
                <option value="rating-desc">Rating: High to Low</option>
                <option value="name-asc">Name: A-Z</option>
                <option value="newest">Newest First</option>
            </select>
        </div>
    </div>

    @* Results Count *@
    @if (!IsLoading && FilteredProducts.Any())
    {
        <div class="results-info">
            <p class="results-text">
                Showing @GetResultsRange() of @FilteredProducts.Count products
            </p>
        </div>
    }

    @* Loading State *@
    @if (IsLoading)
    {
        <div class="product-grid">
            @for (int i = 0; i < 12; i++)
            {
                <SkeletonCard />
            }
        </div>
    }
    @* Error State *@
    else if (HasError)
    {
        <div class="error-state">
            <div class="error-icon">‚ö†Ô∏è</div>
            <h3 class="error-title">Failed to Load Products</h3>
            <p class="error-message">@ErrorMessage</p>
            <PrimaryButton 
                OnClick="LoadProducts" 
                CssClass="btn-retry">
                Try Again
            </PrimaryButton>
        </div>
    }
    @* Empty State *@
    else if (!FilteredProducts.Any())
    {
        <div class="empty-state">
            <div class="empty-icon">üîç</div>
            <h3 class="empty-title">No Products Found</h3>
            <p class="empty-message">
                Try adjusting your filters or search query.
            </p>
            <SecondaryButton 
                Variant="SecondaryButton.ButtonVariant.Outline"
                OnClick="ResetFilters" 
                CssClass="btn-reset">
                Reset Filters
            </SecondaryButton>
        </div>
    }
    @* Product Grid *@
    else
    {
        <div class="product-grid">
            @foreach (var product in CurrentPageProducts)
            {
                <ShopProductCard 
                    Product="@product"
                    OnAddToCart="HandleAddToCart"
                    OnToggleFavorite="HandleToggleFavorite" />
            }
        </div>

        @* Pagination *@
        @if (TotalPages > 1)
        {
            <div class="pagination">
                <button class="pagination-btn" 
                        @onclick="PreviousPage"
                        disabled="@(CurrentPage == 1)">
                    <span class="pagination-icon">‚Üê</span>
                </button>

                <div class="pagination-pages">
                    @foreach (var pageNum in GetVisiblePages())
                    {
                        <button class="pagination-btn @(pageNum == CurrentPage ? "active" : "")"
                                @onclick="@(() => GoToPage(pageNum))">
                            @pageNum
                        </button>
                    }
                </div>

                <button class="pagination-btn" 
                        @onclick="NextPage"
                        disabled="@(CurrentPage == TotalPages)">
                    <span class="pagination-icon">‚Üí</span>
                </button>
            </div>
        }
    }
</div>

@code {
    [CascadingParameter] public ShopLayout? Layout { get; set; }

    private void OpenFilters()
    {
        Layout?.OpenFilters();
    }
}
