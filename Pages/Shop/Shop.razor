@page "/shop"
@page "/shop/{category}"
@using SubashaVentures.Layout.Shop
@using SubashaVentures.Components.Shared.Cards
@using SubashaVentures.Components.Shared.Loading
@layout ShopLayout

<div class="shop-page">
    <!-- Page Header -->
    <div class="shop-header-section">
        <div class="header-content">
            <h1 class="shop-title">
                @if (!string.IsNullOrEmpty(Category) && Category != "all")
                {
                    @GetCategoryDisplayName(Category)
                }
                else
                {
                    <text>All Products</text>
                }
            </h1>
            <p class="shop-subtitle">
                @(isLoading ? "Loading..." : $"{TotalProducts} products found")
            </p>
        </div>
        
        <!-- View Toggle & Sort (Desktop) -->
        <div class="shop-controls desktop-only">
            <div class="view-toggle">
                <button class="view-btn @(viewMode == "grid" ? "active" : "")" 
                        @onclick='() => SetViewMode("grid")'
                        title="Grid View"
                        disabled="@isLoading">
                    ‚äû
                </button>
                <button class="view-btn @(viewMode == "list" ? "active" : "")" 
                        @onclick='() => SetViewMode("list")'
                        title="List View"
                        disabled="@isLoading">
                    ‚ò∞
                </button>
            </div>
            
            <select class="sort-select" @onchange="HandleSortChange" disabled="@isLoading">
                <option value="relevance">Sort: Relevance</option>
                <option value="price-low">Price: Low to High</option>
                <option value="price-high">Price: High to Low</option>
                <option value="rating">Customer Rating</option>
                <option value="newest">Newest First</option>
                <option value="popular">Most Popular</option>
                <option value="name">Name (A-Z)</option>
            </select>
        </div>
    </div>

    <!-- Active Filters -->
    @if (activeFilters.Count > 0 && !isLoading)
    {
        <div class="active-filters">
            <span class="filters-label">Active Filters:</span>
            <div class="filter-tags">
                @foreach (var filter in activeFilters)
                {
                    <span class="filter-tag">
                        @filter
                        <button class="remove-filter" @onclick="() => RemoveFilter(filter)">‚úï</button>
                    </span>
                }
            </div>
            <button class="clear-all-filters" @onclick="ClearAllFilters">
                Clear All
            </button>
        </div>
    }

    <!-- Loading State with Skeleton Cards -->
    @if (isLoading)
    {
        <div class="products-container @viewMode-view">
            @for (int i = 0; i < itemsPerPage; i++)
            {
                <SkeletonCard />
            }
        </div>
    }
    else if (products.Count == 0)
    {
        <!-- Empty State -->
        <div class="empty-state">
            <div class="empty-icon">üì¶</div>
            <h3 class="empty-title">No products found</h3>
            <p class="empty-text">Try adjusting your filters or search terms</p>
            <button class="reset-btn" @onclick="ResetFilters">
                Reset Filters
            </button>
        </div>
    }
    else
    {
        <!-- Products Grid/List -->
        <div class="products-container @viewMode-view">
            @foreach (var product in paginatedProducts)
            {
                <ShopProductCard 
                    Product="@product"
                    IsWishlisted="@wishlistedProductIds.Contains(product.Id)"
                    OnClick="@(p => NavigateToProduct(p))"
                    OnQuickView="@(p => HandleQuickView(p))"
                    OnAddToCart="@(p => HandleAddToCart(p))"
                    OnWishlistToggle="@(p => HandleWishlistToggle(p))"
                />
            }
        </div>

        <!-- Pagination -->
        @if (totalPages > 1)
        {
            <div class="pagination-container">
                <button class="pagination-btn" 
                        disabled="@(currentPage == 1)"
                        @onclick="PreviousPage">
                    ‚Üê Previous
                </button>
                
                <div class="pagination-pages">
                    @{
                        var startPage = Math.Max(1, currentPage - 2);
                        var endPage = Math.Min(totalPages, currentPage + 2);
                        
                        if (startPage > 1)
                        {
                            <button class="page-btn" @onclick="() => GoToPage(1)">1</button>
                            if (startPage > 2)
                            {
                                <span class="pagination-ellipsis">...</span>
                            }
                        }
                        
                        for (int i = startPage; i <= endPage; i++)
                        {
                            var pageNumber = i;
                            <button class="page-btn @(currentPage == pageNumber ? "active" : "")"
                                    @onclick="() => GoToPage(pageNumber)">
                                @pageNumber
                            </button>
                        }
                        
                        if (endPage < totalPages)
                        {
                            if (endPage < totalPages - 1)
                            {
                                <span class="pagination-ellipsis">...</span>
                            }
                            <button class="page-btn" @onclick="() => GoToPage(totalPages)">@totalPages</button>
                        }
                    }
                </div>
                
                <button class="pagination-btn" 
                        disabled="@(currentPage == totalPages)"
                        @onclick="NextPage">
                    Next ‚Üí
                </button>
            </div>
        }
    }
</div>
