@page "/checkout"
@using SubashaVentures.Components.Shared.Buttons
@using SubashaVentures.Components.Shared.Forms
@using SubashaVentures.Layout.Main
@layout LandingPageLayout

<div class="checkout-page">
    <div class="page-header">
        <h1 class="page-title">Checkout</h1>
        <div class="checkout-steps">
            <div class="step @(currentStep >= 1 ? "active" : "") @(currentStep > 1 ? "completed" : "")">
                <span class="step-number">1</span>
                <span class="step-label">Shipping</span>
            </div>
            <div class="step-divider"></div>
            <div class="step @(currentStep >= 2 ? "active" : "") @(currentStep > 2 ? "completed" : "")">
                <span class="step-number">2</span>
                <span class="step-label">Payment</span>
            </div>
            <div class="step-divider"></div>
            <div class="step @(currentStep >= 3 ? "active" : "")">
                <span class="step-number">3</span>
                <span class="step-label">Review</span>
            </div>
        </div>
    </div>

    <div class="checkout-container">
        <!-- Left: Checkout Forms -->
        <div class="checkout-forms">
            @if (currentStep == 1)
            {
                <!-- Step 1: Shipping Information -->
                <div class="checkout-section">
                    <h2 class="section-title">Shipping Information</h2>
                    
                    <div class="form-grid">
                        <InputField Label="First Name"
                                    Type="text"
                                    @bind-Value="firstName"
                                    IsRequired="true"
                                    HasError="@(!string.IsNullOrEmpty(firstNameError))"
                                    ErrorMessage="@firstNameError" />
                        
                        <InputField Label="Last Name"
                                    Type="text"
                                    @bind-Value="lastName"
                                    IsRequired="true"
                                    HasError="@(!string.IsNullOrEmpty(lastNameError))"
                                    ErrorMessage="@lastNameError" />
                    </div>

                    <InputField Label="Phone Number"
                                Type="tel"
                                @bind-Value="phoneNumber"
                                PrefixIcon="üìû"
                                IsRequired="true"
                                HasError="@(!string.IsNullOrEmpty(phoneError))"
                                ErrorMessage="@phoneError" />

                    <InputField Label="Address Line 1"
                                Type="text"
                                @bind-Value="addressLine1"
                                Placeholder="Street address, P.O. box"
                                IsRequired="true"
                                HasError="@(!string.IsNullOrEmpty(addressError))"
                                ErrorMessage="@addressError" />

                    <InputField Label="Address Line 2 (Optional)"
                                Type="text"
                                @bind-Value="addressLine2"
                                Placeholder="Apartment, suite, unit, building, floor, etc." />

                    <div class="form-grid">
                        <InputField Label="City"
                                    Type="text"
                                    @bind-Value="city"
                                    IsRequired="true"
                                    HasError="@(!string.IsNullOrEmpty(cityError))"
                                    ErrorMessage="@cityError" />
                        
                        <InputField Label="State"
                                    Type="text"
                                    @bind-Value="state"
                                    IsRequired="true"
                                    HasError="@(!string.IsNullOrEmpty(stateError))"
                                    ErrorMessage="@stateError" />
                    </div>

                    <InputField Label="Postal Code"
                                Type="text"
                                @bind-Value="postalCode"
                                IsRequired="true"
                                MaxLength="6"
                                HasError="@(!string.IsNullOrEmpty(postalError))"
                                ErrorMessage="@postalError" />

                    <div class="save-address-checkbox">
                        <label class="checkbox-label">
                            <input type="checkbox" @bind="saveAddress" />
                            <span>Save this address for future orders</span>
                        </label>
                    </div>

                    <div class="section-actions">
                        <a href="cart" class="back-link">‚Üê Back to Cart</a>
                        <PrimaryButton Size="PrimaryButton.ButtonSize.Large"
                                       OnClick="GoToPaymentStep">
                            Continue to Payment
                        </PrimaryButton>
                    </div>
                </div>
            }
            else if (currentStep == 2)
            {
                <!-- Step 2: Payment Method -->
                <div class="checkout-section">
                    <h2 class="section-title">Payment Method</h2>
                    
                    <div class="payment-methods">
                        <label class="payment-option @(selectedPaymentMethod == "card" ? "selected" : "")"
                               @onclick='() => SelectPaymentMethod("card")'>
                            <input type="radio" name="payment" value="card" checked="@(selectedPaymentMethod == "card")" />
                            <div class="payment-content">
                                <span class="payment-icon">üí≥</span>
                                <div class="payment-details">
                                    <span class="payment-name">Credit/Debit Card</span>
                                    <span class="payment-desc">Pay securely with your card</span>
                                </div>
                            </div>
                        </label>

                        <label class="payment-option @(selectedPaymentMethod == "transfer" ? "selected" : "")"
                               @onclick='() => SelectPaymentMethod("transfer")'>
                            <input type="radio" name="payment" value="transfer" checked="@(selectedPaymentMethod == "transfer")" />
                            <div class="payment-content">
                                <span class="payment-icon">üè¶</span>
                                <div class="payment-details">
                                    <span class="payment-name">Bank Transfer</span>
                                    <span class="payment-desc">Transfer to our bank account</span>
                                </div>
                            </div>
                        </label>

                        <label class="payment-option @(selectedPaymentMethod == "pod" ? "selected" : "")"
                               @onclick='() => SelectPaymentMethod("pod")'>
                            <input type="radio" name="payment" value="pod" checked="@(selectedPaymentMethod == "pod")" />
                            <div class="payment-content">
                                <span class="payment-icon">üí∞</span>
                                <div class="payment-details">
                                    <span class="payment-name">Pay on Delivery</span>
                                    <span class="payment-desc">Pay when you receive your order</span>
                                </div>
                            </div>
                        </label>
                    </div>

                    <div class="section-actions">
                        <button class="back-link" @onclick="GoToShippingStep">‚Üê Back to Shipping</button>
                        <PrimaryButton Size="PrimaryButton.ButtonSize.Large"
                                       OnClick="GoToReviewStep">
                            Continue to Review
                        </PrimaryButton>
                    </div>
                </div>
            }
            else if (currentStep == 3)
            {
                <!-- Step 3: Review Order -->
                <div class="checkout-section">
                    <h2 class="section-title">Review Your Order</h2>
                    
                    <!-- Shipping Address Review -->
                    <div class="review-card">
                        <div class="review-header">
                            <h3>Shipping Address</h3>
                            <button class="edit-btn" @onclick="GoToShippingStep">Edit</button>
                        </div>
                        <div class="review-content">
                            <p>@firstName @lastName</p>
                            <p>@addressLine1</p>
                            @if (!string.IsNullOrEmpty(addressLine2))
                            {
                                <p>@addressLine2</p>
                            }
                            <p>@city, @state @postalCode</p>
                            <p>@phoneNumber</p>
                        </div>
                    </div>

                    <!-- Payment Method Review -->
                    <div class="review-card">
                        <div class="review-header">
                            <h3>Payment Method</h3>
                            <button class="edit-btn" @onclick="GoToPaymentStep">Edit</button>
                        </div>
                        <div class="review-content">
                            <p>@GetPaymentMethodName(selectedPaymentMethod)</p>
                        </div>
                    </div>

                    <!-- Order Items Review -->
                    <div class="review-card">
                        <div class="review-header">
                            <h3>Order Items (@orderItemsCount items)</h3>
                        </div>
                        <div class="review-items">
                            <p class="placeholder-text">Cart items will be displayed here</p>
                        </div>
                    </div>

                    <div class="section-actions">
                        <button class="back-link" @onclick="GoToPaymentStep">‚Üê Back to Payment</button>
                        <PrimaryButton Size="PrimaryButton.ButtonSize.Large"
                                       OnClick="PlaceOrder"
                                       IsDisabled="@isProcessing">
                            @if (isProcessing)
                            {
                                <span>Processing...</span>
                            }
                            else
                            {
                                <span>Place Order - ‚Ç¶@orderTotal.ToString("N0")</span>
                            }
                        </PrimaryButton>
                    </div>
                </div>
            }
        </div>

        <!-- Right: Order Summary -->
        <div class="order-summary-sidebar">
            <div class="summary-card">
                <h3 class="summary-title">Order Summary</h3>
                
                <div class="summary-details">
                    <div class="summary-row">
                        <span>Subtotal</span>
                        <span>‚Ç¶@subtotal.ToString("N0")</span>
                    </div>
                    <div class="summary-row">
                        <span>Shipping</span>
                        <span>‚Ç¶@shippingCost.ToString("N0")</span>
                    </div>
                    @if (discount > 0)
                    {
                        <div class="summary-row discount">
                            <span>Discount</span>
                            <span>-‚Ç¶@discount.ToString("N0")</span>
                        </div>
                    }
                    <div class="summary-divider"></div>
                    <div class="summary-row total">
                        <span>Total</span>
                        <span>‚Ç¶@orderTotal.ToString("N0")</span>
                    </div>
                </div>

                <div class="secure-checkout">
                    <span class="secure-icon">üîí</span>
                    <span class="secure-text">Secure Checkout</span>
                </div>
            </div>
        </div>
    </div>
</div>

@code {
    // Code will be in .cs file
}