@using SubashaVentures.Domain.Product

<div class="product-card @CssClass" @onclick="HandleCardClick" @onclick:stopPropagation>
    @* IMAGE SECTION - 70% *@
    <div class="card-image-section">
        @if (IsLoading)
        {
            <div class="image-skeleton"></div>
        }
        else
        {
            <img src="@Product.PrimaryImageUrl" 
                 alt="@Product.Name"
                 loading="lazy"
                 class="product-image" />
        }
    </div>

    @* INFO SECTION - 30% (DARK BACKGROUND like Nike) *@
    <div class="card-info-section">
        @* Category *@
        <div class="product-category">@Product.Category?.ToUpper()</div>

        @* Product Name & Price Row *@
        <div class="name-price-row">
            <h3 class="product-name">@Product.Name</h3>
            <div class="product-price">
                @if (Product.IsOnSale && Product.OriginalPrice.HasValue)
                {
                    <span class="original-price">‚Ç¶@Product.OriginalPrice.Value.ToString("N0")</span>
                }
                <span class="current-price">‚Ç¶@Product.Price.ToString("N0")</span>
            </div>
        </div>

        @* Rating *@
        @if (Product.Rating > 0)
        {
            <div class="product-rating">
                @for (int i = 1; i <= 5; i++)
                {
                    <span class="star @(i <= Product.Rating ? "filled" : "")">‚òÖ</span>
                }
                @if (Product.ReviewCount > 0)
                {
                    <span class="review-count">(@Product.ReviewCount)</span>
                }
            </div>
        }

        @* Badges Row *@
        @if (Product.IsOnSale || Product.IsFeatured)
        {
            <div class="badges-row">
                @if (Product.IsOnSale && Product.DiscountPercentage > 0)
                {
                    <span class="badge sale-badge">-@Product.DiscountPercentage%</span>
                }
                @if (Product.IsFeatured)
                {
                    <span class="badge featured-badge">‚òÖ FEATURED</span>
                }
            </div>
        }

        @* Action Buttons Row *@
        <div class="action-buttons-row">
            <button class="add-to-cart-btn" 
                    @onclick="HandleAddToCart" 
                    @onclick:stopPropagation
                    disabled="@(Product.Stock == 0)">
                @if (Product.Stock == 0)
                {
                    <text>OUT OF STOCK</text>
                }
                else
                {
                    <text>ADD TO CART</text>
                }
            </button>
            
            <button class="wishlist-btn @(IsWishlisted ? "active" : "")"
                    @onclick="HandleWishlistToggle"
                    @onclick:stopPropagation
                    title="@(IsWishlisted ? "Remove from wishlist" : "Add to wishlist")">
                <span class="heart-icon">@(IsWishlisted ? "‚ù§Ô∏è" : "ü§ç")</span>
            </button>
        </div>
    </div>
</div>

@code {
    [Parameter] public ProductViewModel Product { get; set; } = default!;
    [Parameter] public string CssClass { get; set; } = "";
    [Parameter] public bool IsLoading { get; set; }
    [Parameter] public bool IsWishlisted { get; set; }
    [Parameter] public EventCallback OnClick { get; set; }
    [Parameter] public EventCallback OnAddToCart { get; set; }
    [Parameter] public EventCallback OnWishlistToggle { get; set; }

    private async Task HandleCardClick()
    {
        await OnClick.InvokeAsync();
    }

    private async Task HandleAddToCart()
    {
        await OnAddToCart.InvokeAsync();
    }

    private async Task HandleWishlistToggle()
    {
        await OnWishlistToggle.InvokeAsync();
    }
}
