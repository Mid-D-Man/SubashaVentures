@using Microsoft.AspNetCore.Components.Authorization
@inherits LayoutComponentBase
@inject NavigationManager Navigation
@inject AuthenticationStateProvider AuthStateProvider
@namespace SubashaVentures.Layout.User

<div class="user-layout">
    <div class="user-sidebar">
        <div class="user-profile-card">
            <div class="user-avatar">
                <img src="@UserAvatar" alt="@UserName" />
            </div>
            <h3 class="user-name">@UserName</h3>
            <p class="user-email">@UserEmail</p>
        </div>

        <nav class="user-nav">
            <a href="user" class="user-nav-item @(IsActive("/user") ? "active" : "")">
                <span class="nav-icon">ğŸ‘¤</span>
                <span class="nav-text">Profile</span>
            </a>
            <a href="user/addresses" class="user-nav-item @(IsActive("/user/addresses") ? "active" : "")">
                <span class="nav-icon">ğŸ“</span>
                <span class="nav-text">Addresses</span>
            </a>
            <a href="user/orders" class="user-nav-item @(IsActive("/user/orders") ? "active" : "")">
                <span class="nav-icon">ğŸ“¦</span>
                <span class="nav-text">Orders</span>
            </a>
            <a href="user/messages" class="user-nav-item @(IsActive("/user/messages") ? "active" : "")">
                <span class="nav-icon">ğŸ’¬</span>
                <span class="nav-text">Messages</span>
            </a>
            <a href="user/reviews" class="user-nav-item @(IsActive("/user/reviews") ? "active" : "")">
                <span class="nav-icon">â­</span>
                <span class="nav-text">Reviews</span>
            </a>
            <a href="user/history" class="user-nav-item @(IsActive("/user/history") ? "active" : "")">
                <span class="nav-icon">ğŸ•</span>
                <span class="nav-text">History</span>
            </a>
            <a href="user/payment" class="user-nav-item @(IsActive("/user/payment") ? "active" : "")">
                <span class="nav-icon">ğŸ’³</span>
                <span class="nav-text">Payment</span>
            </a>
            <a href="user/offers" class="user-nav-item @(IsActive("/user/offers") ? "active" : "")">
                <span class="nav-icon">ğŸ</span>
                <span class="nav-text">Offers</span>
            </a>
            <a href="user/support" class="user-nav-item @(IsActive("/user/support") ? "active" : "")">
                <span class="nav-icon">ğŸ†˜</span>
                <span class="nav-text">Support</span>
            </a>
            <a href="user/settings" class="user-nav-item @(IsActive("/user/settings") ? "active" : "")">
                <span class="nav-icon">âš™ï¸</span>
                <span class="nav-text">Settings</span>
            </a>
        </nav>
    </div>

    <div class="user-content">
        <button class="mobile-menu-toggle" @onclick="ToggleMobileMenu">
            <span class="burger-icon">â˜°</span>
        </button>
        
        @Body
    </div>
</div>

@code {
    private string UserName = "Loading...";
    private string UserEmail = "";
    private string UserAvatar = "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Crect fill='%2396994A' width='100' height='100'/%3E%3Ctext x='50%25' y='50%25' font-size='48' fill='white' text-anchor='middle' dy='.3em'%3EU%3C/text%3E%3C/svg%3E";

    protected override async Task OnInitializedAsync()
    {
        var authState = await AuthStateProvider.GetAuthenticationStateAsync();
        var user = authState.User;
        
        if (user.Identity?.IsAuthenticated == true)
        {
            UserEmail = user.Identity.Name ?? "";
            UserName = user.FindFirst("first_name")?.Value + " " + user.FindFirst("last_name")?.Value ?? "User";
            
            var avatarUrl = user.FindFirst("avatar_url")?.Value;
            if (!string.IsNullOrEmpty(avatarUrl))
            {
                UserAvatar = avatarUrl;
            }
        }
    }

    private bool IsActive(string path)
    {
        return Navigation.Uri.Contains(path);
    }

    private void ToggleMobileMenu()
    {
        // Mobile menu toggle logic
    }
}
