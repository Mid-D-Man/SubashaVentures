@using SubashaVentures.Components.Shared.Loading
@inherits LayoutComponentBase

<div class="shop-layout">
    
    @* Top Navigation *@
    <ShopNavigation 
        CartItemCount="@CartItemCount"
        OnSearchChange="HandleSearchChange" />

    @* Main Content Area *@
    <div class="shop-content">
        
        @* Filter Panel - Desktop Sidebar / Mobile Overlay *@
        <aside class="filter-sidebar @(ShowMobileFilters ? "mobile-open" : "")">
            @if (ShowMobileFilters)
            {
                <div class="mobile-filter-backdrop" @onclick="CloseMobileFilters"></div>
            }
            <ShopFilterPanel 
                CssClass="@(ShowMobileFilters ? "mobile-panel" : "")"
                OnFiltersChange="HandleFiltersChange" />
        </aside>

        @* Main Shop Area *@
        <main class="shop-main">
            @Body
        </main>
    </div>

    @* Footer *@
    <ShopFooter />

    @* Bottom Navigation - Mobile Only *@
    <ShopBottomNav CartItemCount="@CartItemCount" />
</div>

@code {
    [Parameter] public int CartItemCount { get; set; } = 0;
    
    private bool ShowMobileFilters { get; set; } = false;

    private void HandleSearchChange(string query)
    {
        // Search logic will be handled by the page component
        // This is just a pass-through
    }

    private void HandleFiltersChange(ShopFilterPanel.FilterState filters)
    {
        // Filter logic will be handled by the page component
        // This is just a pass-through
        CloseMobileFilters();
    }

    public void ToggleMobileFilters()
    {
        ShowMobileFilters = !ShowMobileFilters;
    }

    private void CloseMobileFilters()
    {
        ShowMobileFilters = false;
    }
}
