@inherits LayoutComponentBase
@inject NavigationManager NavigationManager

<div class="shop-layout">
    @* Top Navigation *@
    <ShopNavigation 
        CartItemCount="@CartItemCount"
        OnSearchChange="@HandleSearchChange" />

    @* Filter Panel Overlay *@
    @if (ShowFilters)
    {
        <div class="filter-overlay" @onclick="CloseFilters">
            <div class="filter-panel-container" @onclick:stopPropagation="true">
                <div class="filter-header">
                    <h2 class="filter-title">Filters</h2>
                    <button class="filter-close-btn" @onclick="CloseFilters">
                        <span class="close-icon">âœ•</span>
                    </button>
                </div>
                <ShopFilterPanel 
                    OnFiltersChange="@HandleFiltersChange"
                    OnClose="@CloseFilters" />
            </div>
        </div>
    }

    @* Main Content *@
    <main class="shop-main">
        @Body
    </main>

    @* Footer *@
    <ShopFooter />
</div>

@code {
    [Parameter] public int CartItemCount { get; set; } = 0;
    
    private bool ShowFilters { get; set; }
    private string SearchQuery { get; set; } = "";

    public void OpenFilters()
    {
        ShowFilters = true;
        StateHasChanged();
    }

    public void CloseFilters()
    {
        ShowFilters = false;
        StateHasChanged();
    }

    private void HandleSearchChange(string query)
    {
        SearchQuery = query;
        // Notify parent/shop page through event or service
        NavigationManager.NavigateTo($"/shop?search={Uri.EscapeDataString(query)}");
    }

    private void HandleFiltersChange(ShopFilterPanel.FilterState filters)
    {
        // This will be called by child components
        StateHasChanged();
    }
}
