@inject NavigationManager NavigationManager
@inject IJSRuntime JSRuntime
@implements IAsyncDisposable

<nav class="admin-nav-menu @(isExpanded ? "expanded" : "collapsed") @(isMobileOpen ? "mobile-open" : "")"
     @ref="navElement"
     @onmouseenter="HandleMouseEnter"
     @onmouseleave="HandleMouseLeave">
    
    <!-- Navigation Header -->
    <div class="nav-header">
        <div class="nav-brand">
            <span class="brand-icon">ðŸŒŸ</span>
            <span class="brand-text">Subasha Admin</span>
        </div>
        
        <button class="nav-toggle-btn desktop-only" 
                @onclick="TogglePinned"
                title="@(isPinned ? "Unpin sidebar" : "Pin sidebar")">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                @if (isPinned)
                {
                    <path d="M10 2L12 8H16L12 12V18L10 16L8 18V12L4 8H8L10 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                }
                else
                {
                    <path d="M10 2L12 8H16L12 12V18L10 16L8 18V12L4 8H8L10 2Z" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" opacity="0.5"/>
                }
            </svg>
        </button>

        <button class="nav-close-btn mobile-only" @onclick="CloseMobileNav">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                <path d="M18 6L6 18M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
        </button>
    </div>

    <!-- Navigation Items -->
    <div class="nav-items">
        @foreach (var section in NavigationSections)
        {
            @if (!string.IsNullOrEmpty(section.Title) && isExpanded)
            {
                <div class="nav-section-title">@section.Title</div>
            }

            @foreach (var item in section.Items)
            {
                @if (item.Children?.Any() == true)
                {
                    <!-- Expandable Item -->
                    <div class="nav-item-group @(expandedGroups.Contains(item.Id) ? "expanded" : "")">
                        <button class="nav-item @(IsCurrentPath(item.Path) ? "active" : "")"
                                @onclick="() => ToggleGroup(item.Id)">
                            <span class="nav-item-icon">@GetIconSvg(item.Icon)</span>
                            <span class="nav-item-label">@item.Label</span>
                            <span class="nav-item-badge" style="display: @(item.Badge > 0 ? "flex" : "none")">@item.Badge</span>
                            <span class="nav-item-arrow">
                                <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                                    <path d="M6 4L10 8L6 12" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                                </svg>
                            </span>
                        </button>
                        
                        <div class="nav-item-children">
                            @foreach (var child in item.Children)
                            {
                                <a href="@child.Path" 
                                   class="nav-item child @(IsCurrentPath(child.Path) ? "active" : "")"
                                   @onclick="() => HandleNavigation(child.Path)">
                                    <span class="nav-item-icon">@GetIconSvg(child.Icon)</span>
                                    <span class="nav-item-label">@child.Label</span>
                                    <span class="nav-item-badge" style="display: @(child.Badge > 0 ? "flex" : "none")">@child.Badge</span>
                                </a>
                            }
                        </div>
                    </div>
                }
                else
                {
                    <!-- Single Item -->
                    <a href="@item.Path" 
                       class="nav-item @(IsCurrentPath(item.Path) ? "active" : "")"
                       @onclick="() => HandleNavigation(item.Path)">
                        <span class="nav-item-icon">@GetIconSvg(item.Icon)</span>
                        <span class="nav-item-label">@item.Label</span>
                        <span class="nav-item-badge" style="display: @(item.Badge > 0 ? "flex" : "none")">@item.Badge</span>
                    </a>
                }
            }
        }
    </div>

    <!-- Navigation Footer -->
    <div class="nav-footer">
        <a href="/admin/settings" class="nav-item">
            <span class="nav-item-icon">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                    <path d="M10 12.5C11.3807 12.5 12.5 11.3807 12.5 10C12.5 8.61929 11.3807 7.5 10 7.5C8.61929 7.5 7.5 8.61929 7.5 10C7.5 11.3807 8.61929 12.5 10 12.5Z" stroke="currentColor" stroke-width="1.5"/>
                    <path d="M16.25 10C16.25 10.625 15.875 11.125 15.25 11.125H14.5C14.125 11.125 13.875 11.375 13.75 11.625L13.5 12.125C13.375 12.375 13.375 12.75 13.625 12.875L14.125 13.25C14.625 13.625 14.75 14.25 14.5 14.75L13.75 16C13.5 16.5 12.875 16.625 12.375 16.375L11.875 16C11.625 15.875 11.25 15.875 11 16L10.5 16.25C10.25 16.375 10 16.625 10 17V17.75C10 18.375 9.5 18.75 8.875 18.75H7.125C6.5 18.75 6 18.375 6 17.75V17C6 16.625 5.75 16.375 5.5 16.25L5 16C4.75 15.875 4.375 15.875 4.125 16L3.625 16.375C3.125 16.625 2.5 16.5 2.25 16L1.5 14.75C1.25 14.25 1.375 13.625 1.875 13.25L2.375 12.875C2.625 12.75 2.625 12.375 2.5 12.125L2.25 11.625C2.125 11.375 1.875 11.125 1.5 11.125H0.75C0.125 11.125 -0.25 10.625 -0.25 10V8.25C-0.25 7.625 0.125 7.125 0.75 7.125H1.5C1.875 7.125 2.125 6.875 2.25 6.625L2.5 6.125C2.625 5.875 2.625 5.5 2.375 5.375L1.875 5C1.375 4.625 1.25 4 1.5 3.5L2.25 2.25C2.5 1.75 3.125 1.625 3.625 1.875L4.125 2.25C4.375 2.375 4.75 2.375 5 2.25L5.5 2C5.75 1.875 6 1.625 6 1.25V0.5C6 -0.125 6.5 -0.5 7.125 -0.5H8.875C9.5 -0.5 10 -0.125 10 0.5V1.25C10 1.625 10.25 1.875 10.5 2L11 2.25C11.25 2.375 11.625 2.375 11.875 2.25L12.375 1.875C12.875 1.625 13.5 1.75 13.75 2.25L14.5 3.5C14.75 4 14.625 4.625 14.125 5L13.625 5.375C13.375 5.5 13.375 5.875 13.5 6.125L13.75 6.625C13.875 6.875 14.125 7.125 14.5 7.125H15.25C15.875 7.125 16.25 7.625 16.25 8.25V10Z" stroke="currentColor" stroke-width="1.5"/>
                </svg>
            </span>
            <span class="nav-item-label">Settings</span>
        </a>
    </div>
</nav>

<!-- Mobile Overlay -->
@if (isMobileOpen)
{
    <div class="mobile-overlay" @onclick="CloseMobileNav"></div>
}
